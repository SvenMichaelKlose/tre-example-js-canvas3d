(fn render (obj)
  (update-canvas)
  (clear-canvas *ctx*)
  (obj.render))

(fn make-plane ()
  (with (vtl  (new vertex -80 -50 0)
         vtr  (new vertex 80 -50 0)
         vbl  (new vertex -80 50 0)
         vbr  (new vertex 80 50 0)
         f    (new face (list vtl vtr vbr vbl)
                        [draw-face-filled *ctx* _ "#00f"]))
    (new object3d (list vtl vtr vbl vbr)
                  f)))

(fn make-animation (obj)
  (with (tt   (new timetable))
    (tt.add 3000 (new track-slots obj
                                  (list "rx")
                                  (list 0)
                                  (list 360))
    tt)))

(fn run-animation (tt obj)
  (play-tracks [0 run-animation tt obj] tt [0 render obj]))

(fn start-site ()
  (document-extend)
  (= document.body.style.margin 0)
  (disable-scrollbars)
;  (= *texture* (make-video :width 640 :height 480 :webm "video.mp4" :loop? t :autoplay? t))
;  (document.body.add *texture*)
;  (*texture*.hide)
;  (= *texture*.muted t)
  (let obj (make-plane)
    (= obj.z 200)
    (!= (make-animation obj)
      ;(native-add-event-listener *texture* "play" #'(() (run-animation ! obj))))))
      (run-animation ! obj))))

(add-onload #'start-site)
