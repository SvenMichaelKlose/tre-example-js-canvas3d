(fn render (obj &key (x 0))
  (update-canvas)
  (clear-canvas *ctx*)
  (= obj.z 200)
  (= obj.rx x)
  (obj.render)
  (do-wait 10 (render obj :x (++ x))))

(fn make-plane ()
  (with (vtl  (new vertex -80 -50 0)
         vtr  (new vertex 80 -50 0)
         vbl  (new vertex -80 50 0)
         vbr  (new vertex 80 50 0)
         f    (new face (list vtl vtr vbr vbl)
                        [draw-face-filled *ctx* _ "#00f"]))
    (new object3d (list vtl vtr vbl vbr)
                  f)))

(fn make-animation ()
  (with (tt   (new timetable))
    (tt.add 3000 (new track-slot (list "z")
                                 (list 0)
                                 (list 360))
    tt)))

(fn start-site ()
  (document-extend)
  (= document.body.style.margin 0)
  (disable-scrollbars)
  (= *texture* (make-video :width 640 :height 480 :webm "video.mp4" :loop? t :autoplay? t))
  (document.body.add *texture*)
  (*texture*.hide)
  (= *texture*.muted t)
  (!= (make-plane) ;(make-object3d-from-vertices-and-faces *vertices* *faces*)
    (native-add-event-listener *texture* "play" #'(() (render !)))))

(add-onload #'start-site)
